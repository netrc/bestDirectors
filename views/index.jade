extends layout

block pagecontent
  div.container
    div.row
      div.col-md-1
        span &nbsp;
      div.col-md-8
        div.row
          div.col-md-3
            label Minimum # of votes
          div.col-md-3
            label Minumum # of movies
        div.row
          div.col-md-3
            select.form-control(data-bind="value: minNumVotes", tabindex="1")
              option 0
              option 5
              option 10
              option 25
              option 50
              option 100
              option 250
              option 500
              option(value=1000) 1,000
              option(value=2000) 2,000
              option(value=5000) 5,000
              option(value=10000) 10,000
              option(value=50000) 50,000
              option(value=100000) 100,000
              option(value=500000) 500,000
              option(value=1000000) 1,000,000
          div.col-md-3
            form(data-bind="submit: getBestPress")
              input(data-bind="value: minNumMovies", tabindex="2")
              // http://jqueryui.com/slider/#default
          div.col-md-1
          div.col-md-1
            button.btn.btn-primary(data-bind="click: getBestPress", tabindex="3") Action!
        div.row
          div.col-md-8
            br
            p(data-bind="text: summary")
            table(width="85%")
              thead
                tr
                  th(width="50%") Director
                  th(width="25%") # Movies
                  th(width="25%") Rating
              tbody(data-bind="foreach: directorNames")
                tr
                  td
                    a(data-bind="text:dn, attr: {href: durl}",  target="_blank")
                  td(data-bind="text: numR")
                  td(data-bind="text: avgR")
      div.col-md-3
        include ads
      
block pagescript
  script.
    var viewModel = function(){
      var self = this;
      self.composerNames = ko.observableArray([ {name:"retrieving..."}]);
      self.minNumVotes = ko.observable(100);
      self.minNumMovies = ko.observable(35);
      self.directorNames = ko.observableArray();
      self.summary = ko.observable("");
      self.finaltext = ko.observable("");
      self.getBestPress = function(item) {
          console.log("getBestPress:" + self.minNumVotes() + " uname:"+self.minNumMovies());
          self.directorNames( [{dn:"retrieving...", numR:"", avgR:"", durl:""}]);
          self.summary("");
          self.finaltext("");
          $.get('/Directors/?minNumVotes='+self.minNumVotes()+"&minNumMovies="+self.minNumMovies(), {}, function(s,tstatus,jxhr) { 
            var d = JSON.parse(s);
            //console.log("getBestPress d = " + d);
            self.summary( d.totalD + " directors made the list! Total number of films: "+ d.totalN+ "  with an average rating of: " + d.totalAvg);
            self.finaltext(d.queryMS+'ms');
            self.directorNames(d.ans);
          });
      };
    };
    $(document).ready(function(){
      ko.applyBindings(new viewModel());
      //$( "#minNumMovies" ).slider({ range: "min", value: 5, min: 0, max: 100, slide: function( event, ui ) { console.log("minNumMovies: "+ui.value); } });
      $('.carousel').carousel();
    });